//Uncomment if you have already created web_store
//DROP DATABASE IF EXISTS web_store
CREATE DATABASE web_store;

USE web_store;

CREATE TABLE IF NOT EXISTS user (
    user_id INT AUTO_INCREMENT,
    email VARCHAR(255) NOT NULL,
    password VARCHAR(255) NOT NULL,
    user_group INT NOT NULL,
    name VARCHAR(255) NOT NULL,
    surname VARCHAR(255) NOT NULL,
    patronymic VARCHAR(255),
    phone_number INT,
    PRIMARY KEY (user_id)
);

CREATE TABLE IF NOT EXISTS confirmation_token (
    user_id INT NOT NULL,
    token VARCHAR(36) NOT NULL,
    FOREIGN KEY (user_id)
            REFERENCES user(user_id)
            ON DELETE CASCADE
            ON UPDATE CASCADE
);

//Scrip for clearing users
//Temporarily not needed
//CREATE EVENT delete_event
//ON SCHEDULE AT CURRENT_TIMESTAMP + INTERVAL 14 DAY
//ON COMPLETION PRESERVE
//DO BEGIN
//      DELETE FROM user WHERE user_id = (SELECT user_id FROM confirmation_token);
//END;

//add admin for tests
INSERT INTO user VALUES(NULL, 'admin@mail.ru', 'qwerty', 1, 'admin', 'admin', NULL, NULL);
